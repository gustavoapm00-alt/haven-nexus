<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AERELION Command Center - Business Management Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-hover: #1a1a25;
      --accent: #6366f1;
      --accent-glow: #818cf8;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #e2e8f0;
      --text-muted: #64748b;
      --border: #1e293b;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated background */
    .bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      pointer-events: none;
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    /* Header */
    .header {
      background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--accent) 0%, #a855f7 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
    }

    .logo-text h1 {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text) 0%, var(--accent-glow) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .logo-text span {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .header-stats {
      display: flex;
      gap: 2rem;
    }

    .header-stat {
      text-align: right;
    }

    .header-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-glow);
    }

    .header-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    /* Main Layout */
    .main {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1.5rem;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: var(--accent);
      box-shadow: 0 0 40px rgba(99, 102, 241, 0.1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title-icon {
      width: 32px;
      height: 32px;
      background: rgba(99, 102, 241, 0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Revenue Card - Full Width */
    .revenue-card {
      grid-column: span 3;
    }

    .revenue-display {
      display: flex;
      align-items: baseline;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .revenue-amount {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--success) 0%, #4ade80 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .revenue-change {
      font-size: 1rem;
      color: var(--success);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Chart */
    .chart-container {
      height: 200px;
      display: flex;
      align-items: flex-end;
      gap: 8px;
      padding: 1rem 0;
    }

    .chart-bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .chart-bar {
      width: 100%;
      background: linear-gradient(180deg, var(--accent) 0%, rgba(99, 102, 241, 0.3) 100%);
      border-radius: 4px 4px 0 0;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .chart-bar:hover {
      background: linear-gradient(180deg, var(--accent-glow) 0%, var(--accent) 100%);
      transform: scaleY(1.05);
      transform-origin: bottom;
    }

    .chart-bar::after {
      content: attr(data-value);
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: var(--text-muted);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .chart-bar:hover::after {
      opacity: 1;
    }

    .chart-label {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* Agents Panel */
    .agents-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .agent-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-hover);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .agent-item:hover {
      border-color: var(--accent);
      transform: translateX(5px);
    }

    .agent-item.active {
      border-color: var(--success);
      background: rgba(34, 197, 94, 0.1);
    }

    .agent-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .agent-info {
      flex: 1;
    }

    .agent-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .agent-category {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .agent-stats {
      text-align: right;
    }

    .agent-revenue {
      font-weight: 600;
      color: var(--success);
    }

    .agent-sales {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Subscription Tiers */
    .tier-grid {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .tier-card {
      padding: 1.25rem;
      border-radius: 12px;
      background: var(--bg-hover);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tier-card:hover {
      transform: scale(1.02);
    }

    .tier-card.starter { border-color: #3b82f6; }
    .tier-card.pro { border-color: #a855f7; }
    .tier-card.elite { border-color: #f59e0b; }

    .tier-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .tier-name {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .tier-price {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .tier-card.starter .tier-price { color: #3b82f6; }
    .tier-card.pro .tier-price { color: #a855f7; }
    .tier-card.elite .tier-price { color: #f59e0b; }

    .tier-progress {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .tier-progress-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .tier-card.starter .tier-progress-bar { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
    .tier-card.pro .tier-progress-bar { background: linear-gradient(90deg, #a855f7, #c084fc); }
    .tier-card.elite .tier-progress-bar { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

    .tier-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Activity Feed */
    .activity-card {
      grid-column: span 2;
    }

    .activity-feed {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      background: var(--bg-hover);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .activity-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .activity-icon.purchase { background: rgba(34, 197, 94, 0.2); }
    .activity-icon.activation { background: rgba(99, 102, 241, 0.2); }
    .activity-icon.signup { background: rgba(168, 85, 247, 0.2); }
    .activity-icon.upgrade { background: rgba(245, 158, 11, 0.2); }

    .activity-content {
      flex: 1;
    }

    .activity-message {
      font-size: 0.9rem;
    }

    .activity-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .activity-amount {
      font-weight: 600;
      color: var(--success);
    }

    /* Actions Panel */
    .actions-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .action-btn {
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--bg-hover);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .action-btn:hover {
      border-color: var(--accent);
      background: rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }

    .action-btn span {
      font-size: 1.5rem;
    }

    /* Metrics Row */
    .metrics-row {
      grid-column: span 3;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .metric-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      border-color: var(--accent);
      transform: translateY(-5px);
    }

    .metric-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .metric-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .metric-card:nth-child(1) .metric-value { color: var(--accent-glow); }
    .metric-card:nth-child(2) .metric-value { color: var(--success); }
    .metric-card:nth-child(3) .metric-value { color: #a855f7; }
    .metric-card:nth-child(4) .metric-value { color: var(--warning); }

    /* Notification Badge */
    .notification-badge {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--success);
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.5s ease;
      z-index: 1000;
    }

    .notification-badge.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      background: rgba(34, 197, 94, 0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .notification-text {
      font-weight: 600;
    }

    .notification-subtext {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Game Controls */
    .game-controls {
      grid-column: span 3;
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
    }

    .game-btn {
      padding: 1rem 2rem;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .game-btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, #a855f7 100%);
      color: white;
    }

    .game-btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
    }

    .game-btn-secondary {
      background: var(--bg-hover);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .game-btn-secondary:hover {
      border-color: var(--accent);
    }

    /* Simulation Speed */
    .speed-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-hover);
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .speed-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .speed-indicator.paused .speed-dot {
      background: var(--danger);
      animation: none;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-dark);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }

    /* Level Up Animation */
    .level-up-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .level-up-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .level-up-content {
      text-align: center;
      animation: levelUpBounce 0.5s ease;
    }

    @keyframes levelUpBounce {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .level-up-icon {
      font-size: 5rem;
      margin-bottom: 1rem;
    }

    .level-up-text {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .level-up-subtext {
      font-size: 1.25rem;
      color: var(--text-muted);
    }

    /* Achievement Toast */
    .achievement-toast {
      position: fixed;
      top: 100px;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
      border-radius: 12px;
      color: #000;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transform: translateX(400px);
      transition: transform 0.5s ease;
      z-index: 1500;
    }

    .achievement-toast.show {
      transform: translateX(0);
    }

    .achievement-toast span {
      font-size: 1.5rem;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .main {
        grid-template-columns: 1fr 1fr;
      }
      .revenue-card, .activity-card, .metrics-row, .game-controls {
        grid-column: span 2;
      }
      .metrics-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .main {
        grid-template-columns: 1fr;
      }
      .revenue-card, .activity-card, .metrics-row, .game-controls {
        grid-column: span 1;
      }
      .metrics-row {
        grid-template-columns: 1fr 1fr;
      }
      .header-stats {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">üöÄ</div>
        <div class="logo-text">
          <h1>AERELION Command Center</h1>
          <span>Haven Nexus Business Simulator</span>
        </div>
      </div>
      <div class="header-stats">
        <div class="header-stat">
          <div class="header-stat-value" id="level">Level 1</div>
          <div class="header-stat-label">Business Level</div>
        </div>
        <div class="header-stat">
          <div class="header-stat-value" id="xp">0 XP</div>
          <div class="header-stat-label">Experience</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Revenue Card -->
    <div class="card revenue-card">
      <div class="card-header">
        <div class="card-title">
          <div class="card-title-icon">üí∞</div>
          Monthly Revenue
        </div>
        <div class="speed-indicator" id="speedIndicator">
          <div class="speed-dot"></div>
          <span id="speedText">Running</span>
        </div>
      </div>
      <div class="revenue-display">
        <div class="revenue-amount" id="totalRevenue">$0</div>
        <div class="revenue-change" id="revenueChange">
          <span>‚Üë</span> +0% this month
        </div>
      </div>
      <div class="chart-container" id="revenueChart"></div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-value" id="totalCustomers">0</div>
        <div class="metric-label">Total Customers</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="activeSubscriptions">0</div>
        <div class="metric-label">Active Subscriptions</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="agentsSold">0</div>
        <div class="metric-label">Agents Sold</div>
      </div>
      <div class="metric-card">
        <div class="metric-value" id="conversionRate">0%</div>
        <div class="metric-label">Conversion Rate</div>
      </div>
    </div>

    <!-- Agents Panel -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <div class="card-title-icon">ü§ñ</div>
          Automation Agents
        </div>
      </div>
      <div class="agents-list" id="agentsList"></div>
    </div>

    <!-- Subscription Tiers -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <div class="card-title-icon">üì¶</div>
          Subscription Bundles
        </div>
      </div>
      <div class="tier-grid" id="tierGrid"></div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <div class="card-title-icon">‚ö°</div>
          Business Actions
        </div>
      </div>
      <div class="actions-grid">
        <button class="action-btn" onclick="runMarketing()">
          <span>üì£</span>
          Marketing Blast
        </button>
        <button class="action-btn" onclick="launchAgent()">
          <span>üöÄ</span>
          Launch Agent
        </button>
        <button class="action-btn" onclick="runPromotion()">
          <span>üéÅ</span>
          Run Promotion
        </button>
        <button class="action-btn" onclick="hireSupport()">
          <span>üë•</span>
          Hire Support
        </button>
        <button class="action-btn" onclick="improveInfra()">
          <span>üîß</span>
          Upgrade Infra
        </button>
        <button class="action-btn" onclick="partnerDeal()">
          <span>ü§ù</span>
          Partner Deal
        </button>
      </div>
    </div>

    <!-- Activity Feed -->
    <div class="card activity-card">
      <div class="card-header">
        <div class="card-title">
          <div class="card-title-icon">üìä</div>
          Live Activity Feed
        </div>
      </div>
      <div class="activity-feed" id="activityFeed"></div>
    </div>

    <!-- Game Controls -->
    <div class="game-controls">
      <button class="game-btn game-btn-secondary" onclick="toggleSimulation()">
        <span id="playPauseIcon">‚è∏Ô∏è</span>
        <span id="playPauseText">Pause</span>
      </button>
      <button class="game-btn game-btn-secondary" onclick="changeSpeed()">
        üèÉ Speed: <span id="speedMultiplier">1x</span>
      </button>
      <button class="game-btn game-btn-primary" onclick="saveGame()">
        üíæ Save Game
      </button>
      <button class="game-btn game-btn-secondary" onclick="resetGame()">
        üîÑ New Game
      </button>
    </div>
  </main>

  <!-- Notification Badge -->
  <div class="notification-badge" id="notification">
    <div class="notification-icon">üíµ</div>
    <div>
      <div class="notification-text" id="notificationText">New Sale!</div>
      <div class="notification-subtext" id="notificationSubtext">+$49</div>
    </div>
  </div>

  <!-- Level Up Overlay -->
  <div class="level-up-overlay" id="levelUpOverlay">
    <div class="level-up-content">
      <div class="level-up-icon">üèÜ</div>
      <div class="level-up-text" id="levelUpText">LEVEL UP!</div>
      <div class="level-up-subtext" id="levelUpSubtext">You've reached Level 2</div>
    </div>
  </div>

  <!-- Achievement Toast -->
  <div class="achievement-toast" id="achievementToast">
    <span>üèÖ</span>
    <span id="achievementText">First Sale!</span>
  </div>

  <script>
    // Game State
    let gameState = {
      running: true,
      speed: 1,
      level: 1,
      xp: 0,
      xpToNext: 100,
      totalRevenue: 0,
      monthlyRevenue: 0,
      totalCustomers: 0,
      activeSubscriptions: 0,
      agentsSold: 0,
      visitors: 0,
      marketingPower: 1,
      supportQuality: 1,
      infraLevel: 1,
      partnerBonus: 1,
      revenueHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      achievements: [],
      agents: [
        { id: 1, name: 'Email Automator', category: 'Marketing', icon: 'üìß', color: '#3b82f6', price: 49, sales: 0, revenue: 0, active: true },
        { id: 2, name: 'Social Scheduler', category: 'Marketing', icon: 'üì±', color: '#8b5cf6', price: 79, sales: 0, revenue: 0, active: true },
        { id: 3, name: 'Data Scraper Pro', category: 'Data', icon: 'üîç', color: '#10b981', price: 99, sales: 0, revenue: 0, active: true },
        { id: 4, name: 'Invoice Generator', category: 'Finance', icon: 'üìÑ', color: '#f59e0b', price: 59, sales: 0, revenue: 0, active: true },
        { id: 5, name: 'Lead Qualifier', category: 'Sales', icon: 'üéØ', color: '#ef4444', price: 149, sales: 0, revenue: 0, active: true },
        { id: 6, name: 'Report Builder', category: 'Analytics', icon: 'üìä', color: '#06b6d4', price: 89, sales: 0, revenue: 0, active: false }
      ],
      tiers: [
        { name: 'Starter', price: 19, subscribers: 0, maxSubscribers: 100, color: 'starter' },
        { name: 'Pro', price: 49, subscribers: 0, maxSubscribers: 50, color: 'pro' },
        { name: 'Elite', price: 99, subscribers: 0, maxSubscribers: 25, color: 'elite' }
      ]
    };

    // Activity types
    const activityTypes = [
      { type: 'purchase', icon: 'üíµ', messages: ['purchased', 'bought'] },
      { type: 'activation', icon: '‚ö°', messages: ['activated', 'deployed'] },
      { type: 'signup', icon: 'üë§', messages: ['signed up for', 'subscribed to'] },
      { type: 'upgrade', icon: '‚¨ÜÔ∏è', messages: ['upgraded to', 'switched to'] }
    ];

    const customerNames = [
      'TechCorp', 'DataFlow Inc', 'CloudNine', 'StartupXYZ', 'MegaSoft',
      'InnovateCo', 'FutureTech', 'AlphaWorks', 'BetaSolutions', 'GammaLabs',
      'DeltaDigital', 'EpsilonEnt', 'ZetaZone', 'EtaSystems', 'ThetaTech'
    ];

    // Initialize
    function init() {
      loadGame();
      renderAgents();
      renderTiers();
      renderChart();
      updateDisplay();
      startSimulation();
    }

    // Render agents list
    function renderAgents() {
      const container = document.getElementById('agentsList');
      container.innerHTML = gameState.agents.map(agent => `
        <div class="agent-item ${agent.active ? 'active' : ''}" onclick="toggleAgent(${agent.id})">
          <div class="agent-icon" style="background: ${agent.color}20; color: ${agent.color}">
            ${agent.icon}
          </div>
          <div class="agent-info">
            <div class="agent-name">${agent.name}</div>
            <div class="agent-category">${agent.category} ‚Ä¢ $${agent.price}</div>
          </div>
          <div class="agent-stats">
            <div class="agent-revenue">$${formatNumber(agent.revenue)}</div>
            <div class="agent-sales">${agent.sales} sales</div>
          </div>
        </div>
      `).join('');
    }

    // Render subscription tiers
    function renderTiers() {
      const container = document.getElementById('tierGrid');
      container.innerHTML = gameState.tiers.map(tier => `
        <div class="tier-card ${tier.color}">
          <div class="tier-header">
            <div class="tier-name">${tier.name}</div>
            <div class="tier-price">$${tier.price}/mo</div>
          </div>
          <div class="tier-progress">
            <div class="tier-progress-bar" style="width: ${(tier.subscribers / tier.maxSubscribers) * 100}%"></div>
          </div>
          <div class="tier-stats">
            <span>${tier.subscribers} subscribers</span>
            <span>$${formatNumber(tier.subscribers * tier.price)}/mo</span>
          </div>
        </div>
      `).join('');
    }

    // Render revenue chart
    function renderChart() {
      const container = document.getElementById('revenueChart');
      const max = Math.max(...gameState.revenueHistory, 1000);
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      container.innerHTML = gameState.revenueHistory.map((value, i) => `
        <div class="chart-bar-wrapper">
          <div class="chart-bar" style="height: ${Math.max((value / max) * 180, 5)}px" data-value="$${formatNumber(value)}"></div>
          <div class="chart-label">${months[i]}</div>
        </div>
      `).join('');
    }

    // Update display
    function updateDisplay() {
      document.getElementById('level').textContent = `Level ${gameState.level}`;
      document.getElementById('xp').textContent = `${gameState.xp}/${gameState.xpToNext} XP`;
      document.getElementById('totalRevenue').textContent = `$${formatNumber(gameState.totalRevenue)}`;
      document.getElementById('totalCustomers').textContent = formatNumber(gameState.totalCustomers);
      document.getElementById('activeSubscriptions').textContent = formatNumber(gameState.activeSubscriptions);
      document.getElementById('agentsSold').textContent = formatNumber(gameState.agentsSold);

      const convRate = gameState.visitors > 0 ? ((gameState.totalCustomers / gameState.visitors) * 100).toFixed(1) : 0;
      document.getElementById('conversionRate').textContent = `${convRate}%`;

      const prevRevenue = gameState.revenueHistory[10] || 1;
      const change = ((gameState.monthlyRevenue - prevRevenue) / prevRevenue * 100).toFixed(0);
      document.getElementById('revenueChange').innerHTML = `<span>${change >= 0 ? '‚Üë' : '‚Üì'}</span> ${change >= 0 ? '+' : ''}${change}% this month`;
    }

    // Simulation loop
    let simulationInterval;
    function startSimulation() {
      if (simulationInterval) clearInterval(simulationInterval);
      simulationInterval = setInterval(() => {
        if (!gameState.running) return;
        simulateTick();
      }, 2000 / gameState.speed);
    }

    // Simulation tick
    function simulateTick() {
      // Generate visitors
      const baseVisitors = 5 * gameState.marketingPower * gameState.partnerBonus;
      const newVisitors = Math.floor(baseVisitors + Math.random() * baseVisitors);
      gameState.visitors += newVisitors;

      // Convert visitors to customers
      const conversionChance = 0.05 * gameState.supportQuality;

      for (let i = 0; i < newVisitors; i++) {
        if (Math.random() < conversionChance) {
          const eventType = Math.random();

          if (eventType < 0.6) {
            // Agent purchase
            const activeAgents = gameState.agents.filter(a => a.active);
            if (activeAgents.length > 0) {
              const agent = activeAgents[Math.floor(Math.random() * activeAgents.length)];
              purchaseAgent(agent);
            }
          } else {
            // Subscription
            const tierIndex = Math.random() < 0.5 ? 0 : Math.random() < 0.7 ? 1 : 2;
            subscribe(tierIndex);
          }
        }
      }

      // Monthly subscription revenue
      gameState.tiers.forEach(tier => {
        const monthlyRevenue = tier.subscribers * tier.price / 30; // Daily portion
        gameState.totalRevenue += monthlyRevenue;
        gameState.monthlyRevenue += monthlyRevenue;
      });

      updateDisplay();
      checkLevelUp();
    }

    // Purchase agent
    function purchaseAgent(agent) {
      agent.sales++;
      agent.revenue += agent.price;
      gameState.agentsSold++;
      gameState.totalRevenue += agent.price;
      gameState.monthlyRevenue += agent.price;
      gameState.totalCustomers++;
      gameState.xp += 10;

      const customer = customerNames[Math.floor(Math.random() * customerNames.length)];
      addActivity('purchase', `${customer} purchased ${agent.name}`, `+$${agent.price}`);
      showNotification(`New Sale!`, `${customer} bought ${agent.name} ‚Ä¢ +$${agent.price}`);

      renderAgents();
      checkAchievements();
    }

    // Subscribe to tier
    function subscribe(tierIndex) {
      const tier = gameState.tiers[tierIndex];
      if (tier.subscribers < tier.maxSubscribers) {
        tier.subscribers++;
        gameState.activeSubscriptions++;
        gameState.totalCustomers++;
        gameState.xp += 15;

        const customer = customerNames[Math.floor(Math.random() * customerNames.length)];
        addActivity('signup', `${customer} subscribed to ${tier.name}`, `+$${tier.price}/mo`);

        renderTiers();
        checkAchievements();
      }
    }

    // Add activity to feed
    function addActivity(type, message, amount) {
      const feed = document.getElementById('activityFeed');
      const activity = activityTypes.find(a => a.type === type);

      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = `
        <div class="activity-icon ${type}">${activity.icon}</div>
        <div class="activity-content">
          <div class="activity-message">${message}</div>
          <div class="activity-time">Just now</div>
        </div>
        <div class="activity-amount">${amount}</div>
      `;

      feed.insertBefore(item, feed.firstChild);

      // Keep only last 20 activities
      while (feed.children.length > 20) {
        feed.removeChild(feed.lastChild);
      }
    }

    // Show notification
    function showNotification(title, subtitle) {
      const notif = document.getElementById('notification');
      document.getElementById('notificationText').textContent = title;
      document.getElementById('notificationSubtext').textContent = subtitle;
      notif.classList.add('show');
      setTimeout(() => notif.classList.remove('show'), 3000);
    }

    // Check level up
    function checkLevelUp() {
      if (gameState.xp >= gameState.xpToNext) {
        gameState.level++;
        gameState.xp -= gameState.xpToNext;
        gameState.xpToNext = Math.floor(gameState.xpToNext * 1.5);

        const overlay = document.getElementById('levelUpOverlay');
        document.getElementById('levelUpSubtext').textContent = `You've reached Level ${gameState.level}!`;
        overlay.classList.add('show');
        setTimeout(() => overlay.classList.remove('show'), 3000);

        // Unlock new agent every 3 levels
        if (gameState.level % 3 === 0) {
          const lockedAgent = gameState.agents.find(a => !a.active);
          if (lockedAgent) {
            lockedAgent.active = true;
            renderAgents();
            showAchievement(`Unlocked ${lockedAgent.name}!`);
          }
        }
      }
    }

    // Check achievements
    function checkAchievements() {
      const achievements = [
        { id: 'first_sale', condition: () => gameState.agentsSold >= 1, text: 'First Sale!' },
        { id: 'ten_sales', condition: () => gameState.agentsSold >= 10, text: '10 Agents Sold!' },
        { id: 'hundred_sales', condition: () => gameState.agentsSold >= 100, text: '100 Agents Sold!' },
        { id: 'first_sub', condition: () => gameState.activeSubscriptions >= 1, text: 'First Subscriber!' },
        { id: 'ten_subs', condition: () => gameState.activeSubscriptions >= 10, text: '10 Subscribers!' },
        { id: 'revenue_1k', condition: () => gameState.totalRevenue >= 1000, text: '$1K Revenue!' },
        { id: 'revenue_10k', condition: () => gameState.totalRevenue >= 10000, text: '$10K Revenue!' },
        { id: 'revenue_100k', condition: () => gameState.totalRevenue >= 100000, text: '$100K Revenue!' }
      ];

      achievements.forEach(ach => {
        if (!gameState.achievements.includes(ach.id) && ach.condition()) {
          gameState.achievements.push(ach.id);
          showAchievement(ach.text);
          gameState.xp += 50;
        }
      });
    }

    // Show achievement
    function showAchievement(text) {
      const toast = document.getElementById('achievementToast');
      document.getElementById('achievementText').textContent = text;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 4000);
    }

    // Toggle agent
    function toggleAgent(id) {
      const agent = gameState.agents.find(a => a.id === id);
      if (agent) {
        agent.active = !agent.active;
        renderAgents();
      }
    }

    // Business Actions
    function runMarketing() {
      if (gameState.totalRevenue >= 100) {
        gameState.totalRevenue -= 100;
        gameState.marketingPower *= 1.1;
        gameState.xp += 20;
        addActivity('activation', 'Marketing campaign launched!', '-$100');
        showNotification('Marketing Boost!', '+10% visitor rate');
        updateDisplay();
      } else {
        showNotification('Not enough funds', 'Need $100 for marketing');
      }
    }

    function launchAgent() {
      const newAgent = {
        id: gameState.agents.length + 1,
        name: `Custom Agent ${gameState.agents.length - 5}`,
        category: 'Custom',
        icon: 'üÜï',
        color: '#' + Math.floor(Math.random()*16777215).toString(16),
        price: Math.floor(50 + Math.random() * 100),
        sales: 0,
        revenue: 0,
        active: true
      };
      gameState.agents.push(newAgent);
      gameState.xp += 30;
      renderAgents();
      showAchievement(`Launched ${newAgent.name}!`);
    }

    function runPromotion() {
      if (gameState.totalRevenue >= 200) {
        gameState.totalRevenue -= 200;
        // Temporary conversion boost
        const originalSupport = gameState.supportQuality;
        gameState.supportQuality *= 2;
        setTimeout(() => gameState.supportQuality = originalSupport, 30000);
        addActivity('activation', 'Promotion started! 2x conversions for 30s', '-$200');
        showNotification('Promo Active!', '2x conversion rate for 30 seconds');
        updateDisplay();
      } else {
        showNotification('Not enough funds', 'Need $200 for promotion');
      }
    }

    function hireSupport() {
      if (gameState.totalRevenue >= 500) {
        gameState.totalRevenue -= 500;
        gameState.supportQuality *= 1.15;
        gameState.xp += 25;
        addActivity('activation', 'New support team member hired!', '-$500');
        showNotification('Team Expanded!', '+15% conversion rate');
        updateDisplay();
      } else {
        showNotification('Not enough funds', 'Need $500 to hire support');
      }
    }

    function improveInfra() {
      if (gameState.totalRevenue >= 1000) {
        gameState.totalRevenue -= 1000;
        gameState.infraLevel++;
        gameState.tiers.forEach(t => t.maxSubscribers = Math.floor(t.maxSubscribers * 1.5));
        gameState.xp += 50;
        renderTiers();
        addActivity('activation', `Infrastructure upgraded to Level ${gameState.infraLevel}!`, '-$1000');
        showNotification('Infra Upgraded!', '+50% subscriber capacity');
        updateDisplay();
      } else {
        showNotification('Not enough funds', 'Need $1000 for infrastructure');
      }
    }

    function partnerDeal() {
      if (gameState.totalRevenue >= 2000) {
        gameState.totalRevenue -= 2000;
        gameState.partnerBonus *= 1.25;
        gameState.xp += 75;
        addActivity('activation', 'New partnership established!', '-$2000');
        showNotification('Partnership Active!', '+25% visitor traffic');
        updateDisplay();
      } else {
        showNotification('Not enough funds', 'Need $2000 for partnership');
      }
    }

    // Game controls
    function toggleSimulation() {
      gameState.running = !gameState.running;
      document.getElementById('playPauseIcon').textContent = gameState.running ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
      document.getElementById('playPauseText').textContent = gameState.running ? 'Pause' : 'Play';
      document.getElementById('speedIndicator').classList.toggle('paused', !gameState.running);
      document.getElementById('speedText').textContent = gameState.running ? 'Running' : 'Paused';
    }

    function changeSpeed() {
      const speeds = [1, 2, 5, 10];
      const currentIndex = speeds.indexOf(gameState.speed);
      gameState.speed = speeds[(currentIndex + 1) % speeds.length];
      document.getElementById('speedMultiplier').textContent = `${gameState.speed}x`;
      startSimulation();
    }

    function saveGame() {
      localStorage.setItem('havenNexusGame', JSON.stringify(gameState));
      showNotification('Game Saved!', 'Progress saved to browser');
    }

    function loadGame() {
      const saved = localStorage.getItem('havenNexusGame');
      if (saved) {
        gameState = { ...gameState, ...JSON.parse(saved) };
      }
    }

    function resetGame() {
      if (confirm('Are you sure you want to start a new game? All progress will be lost.')) {
        localStorage.removeItem('havenNexusGame');
        location.reload();
      }
    }

    // Utility
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return Math.floor(num).toLocaleString();
    }

    // Update monthly revenue history
    setInterval(() => {
      gameState.revenueHistory.shift();
      gameState.revenueHistory.push(gameState.monthlyRevenue);
      gameState.monthlyRevenue = 0;
      renderChart();
    }, 60000); // Every minute represents a month

    // Start the game
    init();
  </script>
</body>
</html>
